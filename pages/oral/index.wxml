<!--pages/oral/index.wxml-->
<view class="container">
  <!-- Topic Selection Dialog -->
  <view class="topic-dialog {{showTopicDialog ? 'show' : ''}}" wx:if="{{showTopicDialog}}">
    <view class="topic-dialog-content">
      <view class="topic-dialog-header">
        <text class="topic-dialog-title">想聊点什么话题？</text>
        <view class="topic-dialog-actions">
          <view class="refresh-btn" bind:tap="refreshTopics">
            <i class="iconfont icon-refresh"></i>
          </view>
          <view class="close-btn" bind:tap="closeTopicDialog">
            <i class="iconfont icon-close"></i>
          </view>
        </view>
      </view>
      <scroll-view class="topics-list" scroll-y="true">
        <view 
          class="topic-item" 
          hover-class="topic-item-hover"
          wx:for="{{topics}}" 
          wx:key="index"
          data-index="{{index}}"
          bind:tap="selectTopic"
        >
          <text data-item="{{item}}">{{item}}</text>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- Header -->
  <view class="header">
    <view class="avatar">
      <image src="/resources/teacher3.png" mode="aspectFit"></image>
    </view>
  </view>

  <!-- Chat Content -->
  <scroll-view class="chat-content" scroll-y="true">
    <view class="message-bubble">
      <block wx:for="{{ chatContent }}" wx:key="index">
        <view class="model" wx:if="{{ item.role === 'model' }}">
          <text user-select>{{ item.content }}</text>
          <i class="iconfont icon-bofang" 
            wx:if="{{ !item.playing }}"
            bind:tap="playContent" 
            data-content="{{item.content}}"></i>
          <i class="iconfont icon-voiceprint" wx:if="{{ item.playing }}"></i>
        </view>
        <view class="user" wx:if="{{ item.role === 'user' }}">
          <!-- <text user-select wx:if="{{ !item.type }}">{{ item.content }}</text> -->
          <audio src="{{item.content}}" wx:if="{{item.role === 'user'}}"></audio>
          <i class="iconfont icon-bofang" 
            wx:if="{{ !item.playing }}"
            bind:tap="playContent"
            data-content="{{item.content}}"></i>
          <i class="iconfont icon-voiceprint" wx:if="{{ item.playing }}"></i>
        </view>
      </block>
    </view>
  </scroll-view>

  <!-- Bottom Toolbar -->
  <view wx:if="{{ recording }}" class="voice-wave1">
    <view class="wave-bar"></view>
    <view class="wave-bar"></view>
    <view class="wave-bar"></view>
    <view class="wave-bar"></view>
  </view>
  <view class="bottom-toolbar">
    <view class="btn-group">
      <view class="cancel-btn" wx:if="{{ recording }}">
        <i class="iconfont icon-close" bind:tap="cancelRecord"></i>
      </view>
      <view class="input-controls">
        <view class="mic-btn">
          <i class="iconfont icon-luyin" 
            wx:if="{{ !recording }}"
            bind:tap="onRecord"></i>
          <i class="iconfont icon-send" 
            wx:if="{{ recording }}"
            bind:tap="send"></i>
        </view>
      </view>
    </view> 
  </view>
</view>